<template>
  <div class="header-container">
    <div class="header-block">
      <div class="left-block">
        <NuxtLink
            to="/"
            class="custom-link"
        >
          <div class="ico">
            <img src="/night.png" alt="Логотип компании">
          </div>
        </NuxtLink>
        <div class="search">
          <Input
              :value="searchInput.searchValue"
              :placeholder="'Поиск по товарам...'"
          />
          <MainButton
              :classes="['main', 'small']"
              @click="initSearchProducts"
          >
            <p class="_non-space">Найти</p>
          </MainButton>
        </div>
      </div>
      <NuxtLink
          to="/products"
          class="custom-link button-link"
      >
        <p class="_non-space">Магазин</p>
      </NuxtLink>
      <div class="right-side">
        <NuxtLink
            to="/favorites"
            class="custom-link"
        >
          <div class="ico-btn">
            <svg width="33" height="33"
                 viewBox="0 0 33 33"
                 fill="none"
                 xmlns="http://www.w3.org/2000/svg"
            >
              <path
                  d="M23.4534 0C21.9447 0.0251775 20.4689 0.477035 19.175 1.30994C17.8812 2.14285 16.8151 3.32731 16.0844 4.74371C15.3537 3.32731 14.2876 2.14285 12.9937 1.30994C11.6999 0.477035 10.2241 0.0251775 8.71534 0C6.31028 0.112111 4.04432 1.24092 2.41252 3.13981C0.780716 5.0387 -0.0842876 7.55331 0.00648623 10.1343C0.00648623 19.8733 14.6856 31.1216 15.31 31.5989L16.0844 32.1868L16.8588 31.5989C17.4832 31.1245 32.1623 19.8733 32.1623 10.1343C32.253 7.55331 31.388 5.0387 29.7562 3.13981C28.1244 1.24092 25.8585 0.112111 23.4534 0ZM16.0844 28.6477C11.7259 25.1546 2.68613 16.5728 2.68613 10.1343C2.59454 8.31546 3.177 6.53156 4.30647 5.17165C5.43594 3.81174 7.02078 2.98617 8.71534 2.87498C10.4099 2.98617 11.9947 3.81174 13.1242 5.17165C14.2537 6.53156 14.8361 8.31546 14.7445 10.1343H17.4242C17.3326 8.31546 17.9151 6.53156 19.0445 5.17165C20.174 3.81174 21.7588 2.98617 23.4534 2.87498C25.148 2.98617 26.7328 3.81174 27.8623 5.17165C28.9917 6.53156 29.5742 8.31546 29.4826 10.1343C29.4826 16.5757 20.4428 25.1546 16.0844 28.6477Z"
                  fill="#FFD600"/>
            </svg>
          </div>
        </NuxtLink>
        <NuxtLink
            to="/basket"
            class="custom-link"
        >
          <div class="ico-btn">
            <svg width="30"
                 height="30"
                 viewBox="0 0 30 30"
                 fill="none"
                 xmlns="http://www.w3.org/2000/svg"
            >
              <g clip-path="url(#clip0_439_357)">
                <path
                    d="M28.3912 5.09625C28.0396 4.6743 27.5995 4.33494 27.1019 4.10227C26.6044 3.8696 26.0617 3.74933 25.5125 3.75H5.3025L5.25 3.31125C5.14256 2.39927 4.70423 1.55842 4.01811 0.948097C3.33199 0.337779 2.44578 0.000427242 1.5275 0L1.25 0C0.918479 0 0.600537 0.131696 0.366117 0.366117C0.131696 0.600537 0 0.918479 0 1.25C0 1.58152 0.131696 1.89946 0.366117 2.13388C0.600537 2.3683 0.918479 2.5 1.25 2.5H1.5275C1.83367 2.50004 2.12917 2.61245 2.35796 2.81589C2.58676 3.01934 2.73293 3.29969 2.76875 3.60375L4.48875 18.2288C4.66732 19.7497 5.3981 21.1522 6.54239 22.17C7.68667 23.1878 9.16482 23.75 10.6962 23.75H23.75C24.0815 23.75 24.3995 23.6183 24.6339 23.3839C24.8683 23.1495 25 22.8315 25 22.5C25 22.1685 24.8683 21.8505 24.6339 21.6161C24.3995 21.3817 24.0815 21.25 23.75 21.25H10.6962C9.92257 21.2478 9.1685 21.0064 8.53742 20.5588C7.90634 20.1113 7.42914 19.4794 7.17125 18.75H22.0712C23.5366 18.7501 24.9554 18.2353 26.0798 17.2955C27.2041 16.3558 27.9625 15.0509 28.2225 13.6088L29.2038 8.16625C29.3017 7.62626 29.2797 7.07133 29.1393 6.5408C28.9989 6.01026 28.7435 5.5171 28.3912 5.09625ZM26.75 7.7225L25.7675 13.165C25.6114 14.0312 25.1556 14.815 24.4798 15.379C23.8041 15.943 22.9514 16.2513 22.0712 16.25H6.77375L5.5975 6.25H25.5125C25.6961 6.2489 25.8777 6.28828 26.0444 6.36532C26.2111 6.44236 26.3588 6.55518 26.4769 6.69576C26.595 6.83634 26.6808 7.00121 26.728 7.17867C26.7752 7.35613 26.7827 7.54181 26.75 7.7225Z"
                    fill="#FFD600"/>
                <path
                    d="M8.75 30C10.1307 30 11.25 28.8807 11.25 27.5C11.25 26.1193 10.1307 25 8.75 25C7.36929 25 6.25 26.1193 6.25 27.5C6.25 28.8807 7.36929 30 8.75 30Z"
                    fill="#FFD600"/>
                <path
                    d="M21.25 30C22.6307 30 23.75 28.8807 23.75 27.5C23.75 26.1193 22.6307 25 21.25 25C19.8693 25 18.75 26.1193 18.75 27.5C18.75 28.8807 19.8693 30 21.25 30Z"
                    fill="#FFD600"/>
              </g>
              <defs>
                <clipPath id="clip0_439_357">
                  <rect width="30" height="30" fill="white"/>
                </clipPath>
              </defs>
            </svg>
            <div
                class="count-basket-products"
                v-if="productsBasketCount > 0"
            >
              <p class="_non-space count">{{ productsBasketCount }}</p>
            </div>
          </div>
        </NuxtLink>
        <NuxtLink
            :to="hasLogin ? '/settings': '/auth'"
            class="custom-link"
        >
          <div class="ico-btn">
            <svg width="23"
                 height="33"
                 viewBox="0 0 23 33"
                 fill="none"
                 xmlns="http://www.w3.org/2000/svg"
            >
              <path
                  d="M11.25 16.0934C12.7334 16.0934 14.1834 15.6215 15.4168 14.7373C16.6501 13.8531 17.6114 12.5964 18.1791 11.126C18.7468 9.6557 18.8953 8.03778 18.6059 6.47687C18.3165 4.91596 17.6022 3.48218 16.5533 2.35683C15.5044 1.23148 14.168 0.465102 12.7132 0.154619C11.2583 -0.155865 9.75032 0.00348652 8.37988 0.612522C7.00943 1.22156 5.83809 2.25292 5.01398 3.5762C4.18987 4.89947 3.75 6.45522 3.75 8.0467C3.75199 10.1802 4.5428 12.2256 5.94889 13.7342C7.35499 15.2428 9.26149 16.0913 11.25 16.0934ZM11.25 2.68224C12.2389 2.68224 13.2056 2.99686 14.0279 3.58631C14.8501 4.17577 15.491 5.01358 15.8694 5.99381C16.2478 6.97404 16.3469 8.05265 16.1539 9.09326C15.961 10.1339 15.4848 11.0897 14.7855 11.84C14.0863 12.5902 13.1954 13.1011 12.2255 13.3081C11.2555 13.5151 10.2502 13.4088 9.33658 13.0028C8.42295 12.5968 7.64206 11.9092 7.09265 11.027C6.54325 10.1449 6.25 9.10769 6.25 8.0467C6.25 6.62396 6.77678 5.25948 7.71447 4.25345C8.65215 3.24742 9.92392 2.68224 11.25 2.68224Z"
                  fill="#FFD600"/>
              <path
                  d="M11.25 18.7754C8.26733 18.7789 5.40777 20.0517 3.2987 22.3145C1.18964 24.5774 0.00330857 27.6454 0 30.8454C0 31.2011 0.131696 31.5422 0.366117 31.7938C0.600537 32.0453 0.91848 32.1866 1.25 32.1866C1.58152 32.1866 1.89946 32.0453 2.13388 31.7938C2.3683 31.5422 2.5 31.2011 2.5 30.8454C2.5 28.3556 3.42187 25.9678 5.06282 24.2073C6.70376 22.4467 8.92936 21.4576 11.25 21.4576C13.5706 21.4576 15.7962 22.4467 17.4372 24.2073C19.0781 25.9678 20 28.3556 20 30.8454C20 31.2011 20.1317 31.5422 20.3661 31.7938C20.6005 32.0453 20.9185 32.1866 21.25 32.1866C21.5815 32.1866 21.8995 32.0453 22.1339 31.7938C22.3683 31.5422 22.5 31.2011 22.5 30.8454C22.4967 27.6454 21.3104 24.5774 19.2013 22.3145C17.0922 20.0517 14.2327 18.7789 11.25 18.7754Z"
                  fill="#FFD600"/>
            </svg>
          </div>
        </NuxtLink>
      </div>
    </div>
  </div>
</template>

<script lang="ts">
import {useProductsStore} from "~/store/productsStore"

export default {
  data() {
    return {
      searchInput: {
        searchValue: '',
        oldSearchValue: '',
      },
      hasLogin: false
    }
  },
  setup() {
    const productsStore = useProductsStore()
    return {productsStore}
  },
  computed: {
    productsBasketCount() {
      return this.productsStore.getProductsBasketCount
    }
  },
  methods: {
    async initSearchProducts() {
      if (this.searchInput.searchValue.trim() === '') {
        this.productsStore.setProductsSearch([])
        return
      }
      if (this.searchInput.searchValue.trim().length < 3 ||
          this.searchInput.oldSearchValue === this.searchInput.searchValue.trim() &&
          !hasNewParameter) return

      this.loadingSearch = true

      this.searchInput.oldSearchValue = this.searchInput.searchValue.trim()

      await this.productsStore.initSearch({
        searchValue: this.searchInput.searchValue.trim()
      })

      this.loadingSearch = false
      this.openResult = true
    },
  }
}
</script>

<style scoped>
</style>